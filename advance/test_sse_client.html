<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SSE å¢é‡æµå¼å“åº”æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        .output-section {
            margin-top: 20px;
        }
        .field-container {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
        }
        .field-label {
            font-weight: bold;
            color: #495057;
            margin-bottom: 10px;
            font-size: 16px;
        }
        .field-content {
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            min-height: 20px;
            white-space: pre-wrap;
        }
        .title-content {
            color: #28a745;
            font-weight: bold;
        }
        .summary-content {
            color: #007bff;
        }
        .status-log {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        .status {
            padding: 5px 10px;
            border-radius: 4px;
            margin: 5px 0;
            font-weight: bold;
        }
        .status.start { background-color: #d4edda; color: #155724; }
        .status.chunk { background-color: #d1ecf1; color: #0c5460; }
        .status.end { background-color: #d4edda; color: #155724; }
        .status.error { background-color: #f8d7da; color: #721c24; }
        .status.info { background-color: #e2e3e5; color: #383d41; }
    </style>
</head>
<body>
    <div class="container">
        <h1>SSE å¢é‡æµå¼å“åº”æµ‹è¯•</h1>
        <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®å¼€å§‹æ¥æ”¶æ¥è‡ªå¤§æ¨¡å‹çš„å¢é‡æµå¼å“åº”ï¼š</p>
        
        <button id="startBtn" onclick="startSSE()">å¼€å§‹æ¥æ”¶æµå¼å“åº”</button>
        <button id="stopBtn" onclick="stopSSE()" disabled>åœæ­¢æ¥æ”¶</button>
        <button onclick="clearOutput()">æ¸…ç©ºè¾“å‡º</button>
        
        <div class="output-section">
            <div class="field-container">
                <div class="field-label">ğŸ“ æ ‡é¢˜ (Title):</div>
                <div id="titleContent" class="field-content title-content"></div>
            </div>
            
            <div class="field-container">
                <div class="field-label">ğŸ“„ æ‘˜è¦ (Summary):</div>
                <div id="summaryContent" class="field-content summary-content"></div>
            </div>
        </div>
        
        <div class="status-log" id="statusLog">
            <div class="field-label">ğŸ“Š çŠ¶æ€æ—¥å¿—:</div>
        </div>
    </div>

    <script>
        let eventSource = null;
        let titleContent = "";
        let summaryContent = "";

        function startSSE() {
            const startBtn = document.getElementById('startBtn');
            const stopBtn = document.getElementById('stopBtn');
            
            // æ¸…ç©ºè¾“å‡º
            clearOutput();
            
            // ç¦ç”¨å¼€å§‹æŒ‰é’®ï¼Œå¯ç”¨åœæ­¢æŒ‰é’®
            startBtn.disabled = true;
            stopBtn.disabled = false;
            
            // åˆ›å»º EventSource è¿æ¥
            eventSource = new EventSource('http://localhost:5001/helloworld');
            
            // ç›‘å¬æ¶ˆæ¯
            eventSource.onmessage = function(event) {
                try {
                    const data = JSON.parse(event.data);
                    displayMessage(data);
                } catch (e) {
                    console.error('è§£ææ¶ˆæ¯å¤±è´¥:', e);
                    displayMessage({ status: 'error', message: 'æ¶ˆæ¯è§£æå¤±è´¥: ' + event.data });
                }
            };
            
            // ç›‘å¬è¿æ¥æ‰“å¼€
            eventSource.onopen = function(event) {
                console.log('SSE è¿æ¥å·²å»ºç«‹');
                displayMessage({ status: 'info', message: 'SSE è¿æ¥å·²å»ºç«‹' });
            };
            
            // ç›‘å¬é”™è¯¯
            eventSource.onerror = function(event) {
                console.error('SSE è¿æ¥é”™è¯¯:', event);
                displayMessage({ status: 'error', message: 'SSE è¿æ¥é”™è¯¯' });
                stopSSE();
            };
        }
        
        function stopSSE() {
            if (eventSource) {
                eventSource.close();
                eventSource = null;
            }
            
            const startBtn = document.getElementById('startBtn');
            const stopBtn = document.getElementById('stopBtn');
            
            startBtn.disabled = false;
            stopBtn.disabled = true;
            
            displayMessage({ status: 'info', message: 'SSE è¿æ¥å·²å…³é—­' });
        }
        
        function displayMessage(data) {
            const statusLog = document.getElementById('statusLog');
            const timestamp = new Date().toLocaleTimeString();
            
            let message = `[${timestamp}] `;
            
            switch(data.status) {
                case 'start':
                    message += `ğŸš€ ${data.message}`;
                    break;
                case 'chunk':
                    // å¤„ç†å¢é‡æ•°æ®
                    if (data.data) {
                        if (data.data.title !== undefined) {
                            titleContent += data.data.title;
                            document.getElementById('titleContent').textContent = titleContent;
                            message += `ğŸ“ æ ‡é¢˜å¢é‡: "${data.data.title}"`;
                        }
                        if (data.data.summary !== undefined) {
                            summaryContent += data.data.summary;
                            document.getElementById('summaryContent').textContent = summaryContent;
                            message += `ğŸ“„ æ‘˜è¦å¢é‡: "${data.data.summary}"`;
                        }
                    }
                    break;
                case 'end':
                    message += `âœ… ${data.message}`;
                    break;
                case 'error':
                    message += `âŒ é”™è¯¯: ${data.message}`;
                    break;
                case 'info':
                    message += `â„¹ï¸ ${data.message}`;
                    break;
                default:
                    message += `â“ æœªçŸ¥çŠ¶æ€: ${JSON.stringify(data)}`;
            }
            
            // æ·»åŠ åˆ°çŠ¶æ€æ—¥å¿—
            const logEntry = document.createElement('div');
            logEntry.textContent = message;
            statusLog.appendChild(logEntry);
            statusLog.scrollTop = statusLog.scrollHeight;
        }
        
        function clearOutput() {
            titleContent = "";
            summaryContent = "";
            document.getElementById('titleContent').textContent = "";
            document.getElementById('summaryContent').textContent = "";
            document.getElementById('statusLog').innerHTML = '<div class="field-label">ğŸ“Š çŠ¶æ€æ—¥å¿—:</div>';
        }
        
        // é¡µé¢å¸è½½æ—¶å…³é—­è¿æ¥
        window.onbeforeunload = function() {
            if (eventSource) {
                eventSource.close();
            }
        };
    </script>
</body>
</html> 